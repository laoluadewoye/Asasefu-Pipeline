<div class="results-div">
    <!--Search bar-->
    <span id="result-search">
        <label for="resultSearch">Search for results by session ID or Nickname:</label>
        <input type="text" id="resultSearch" name="resultSearch" [formControl]="resultSearch">
    </span>

    <!--Section header-->
    <h2 id="results-div">Completed Parses</h2>
    <div class="center-content">
        <button class="button-padding" (click)="refreshView()">Refresh View</button>
        @if (isRefreshing()) {
            <div class="success fade-in" animate.leave="fade-out">
                <p>Refreshing result menu...</p>
            </div>
        }
    </div>

    <!--Section tabs-->
    <div id="result-div-menu">
        <div 
            class="results-menu-tab" 
            [class.red-background]="activeTab() === 'full-sessions'" 
            (click)="selectTab('full-sessions')"
        >
            <h3>Sessions (Stories and Chapters)</h3>
        </div>
        <div 
            class="results-menu-tab" 
            [class.red-background]="activeTab() === 'story-metadata-only'" 
            (click)="selectTab('story-metadata-only')"
        >
            <h3>Story Metadata Only</h3>
        </div>
        <div 
            class="results-menu-tab" 
            [class.red-background]="activeTab() === 'chapters-only'" 
            (click)="selectTab('chapters-only')"
        >
            <h3>Individual Chapters Only</h3>
        </div>
    </div>

    <!--Section content-->
    <div id="result-div-content">
        @if (activeTab() === "full-sessions") {
            <div id="result-div-full-sessions" class="fade-in">
                @if (parentLatestCompletedSessionId() !== "") {
                    <app-session 
                        [completedSession]="filterCompletedSession(getLatestCompletedSession())" 
                        [latestUnit]="true" 
                        [parentNicknameDisplayLimit]="nicknameDisplayLimit"
                        [parentOutputListDisplayLimit]="outputListDisplayLimit"
                        [parentOutputParagraphDisplayLimit]="outputParagraphDisplayLimit"
                    />
                }
                @for (value of filterCompletedSessions(completedSessionMap().values()); track value) {
                    @if (value.data.id !== parentLatestCompletedSessionId()) {
                        <app-session 
                            [completedSession]="value" 
                            [latestUnit]="false" 
                            [parentNicknameDisplayLimit]="nicknameDisplayLimit"
                            [parentOutputListDisplayLimit]="outputListDisplayLimit"
                            [parentOutputParagraphDisplayLimit]="outputParagraphDisplayLimit" 
                        />
                    }
                }
            </div>
        }
        @if (activeTab() === "story-metadata-only") {
            <div id="result-div-story-metadata-only" class="fade-in">
                @if (parentLatestCompletedSessionId() !== "") {
                    <app-story-metadata 
                        [storyMetadataResultUnit]="filterStoryMetadataUnit(latestStoryMetadataUnit())" 
                        [latestUnit]="true"
                        [parentOutputListDisplayLimit]="outputListDisplayLimit"
                        [parentNicknameDisplayLimit]="nicknameDisplayLimit"
                    />
                }
                @for (value of filterStoryMetadataUnits(storyMetadataMap().values()); track value) {
                    @if (value.id !== parentLatestCompletedSessionId()) {
                        <app-story-metadata 
                            [storyMetadataResultUnit]="value" 
                            [latestUnit]="false"
                            [parentOutputListDisplayLimit]="outputListDisplayLimit"
                            [parentNicknameDisplayLimit]="nicknameDisplayLimit"
                        />
                    }
                }
            </div>
        }
        @if (activeTab() === "chapters-only") {
            <div id="result-div-chapters-only" class="fade-in">
                @if (latestChapterUnitId() !== "") {
                    <app-chapter 
                        [chapterResultUnit]="filterChapterUnit(latestChapterUnit())" 
                        [latestUnit]="true" 
                        [partOfSession]="false"
                        [parentNicknameDisplayLimit]="nicknameDisplayLimit"
                        [parentOutputListDisplayLimit]="outputListDisplayLimit"
                        [parentOutputParagraphDisplayLimit]="outputParagraphDisplayLimit"
                    />
                }
                @for (value of filterChapterUnits(chapterMap().values()); track value) {
                    @if (value.id !== latestChapterUnitId()) {
                        <app-chapter 
                            [chapterResultUnit]="value" 
                            [latestUnit]="false" 
                            [partOfSession]="false"
                            [parentNicknameDisplayLimit]="nicknameDisplayLimit"
                            [parentOutputListDisplayLimit]="outputListDisplayLimit"
                            [parentOutputParagraphDisplayLimit]="outputParagraphDisplayLimit"
                        />
                    }
                }
            </div>
        }
    </div>
</div>
